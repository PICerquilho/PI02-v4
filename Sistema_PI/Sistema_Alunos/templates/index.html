
{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro e consulta de alunos.</title>
    <link rel="shortcut icon" href="{% static 'imagens/brasao.png' %}" type="image/x-icon">

    <!-- Link para o Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <script src="{% static 'js/script.js' %}"></script>
    <link rel="stylesheet" href="{% static 'css/media-query.css' %}">
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <header>
        <h1>Cadastro de Aluno</h1>
        <div class="header-image">
            <img src="{% static 'imagens/brasao3.png' %}" alt="Imagem do Cabe√ßalho">
        </div>
        <nav>
            <div class="nav-buttons">
                <a href="{% url 'index' %}"><button>üè† Home</button></a>
                <a href="{% url 'dashboard' %}"><button>üìä Dashboard</button>
                </a>
                <a href="{% url 'cadastro' %}">
                    <button><i class="fas fa-user-plus"></i> Cadastrar Aluno</button>
                </a>
                <form method="post" action="{% url 'logout' %}" style="display: inline;">{% csrf_token %}
                <button type="submit">üö™ Logout</button>
</form>
                
            </div>
        </nav>
    </header>

    <div class="container">
        <input type="text" id="busca" placeholder="Digite o Nome Social, RA, RG, S√©rie ou Per√≠odo">
        
        <!-- Filtros adicionais -->
        <select id="filtroSerie" class="form-control">
            <option value="">Selecione o Ano</option>
            <option value="1¬™ Ano">1¬™ Ano</option>
            <option value="2¬™ Ano">2¬™ Ano</option>
            <option value="3¬™ Ano">3¬™ Ano</option>
            <option value="4¬™ Ano">4¬™ Ano</option>
            <option value="5¬™ Ano">5¬™ Ano</option>
            <option value="6¬™ Ano">6¬™ Ano</option>
            <option value="7¬™ Ano">7¬™ Ano</option>
            <option value="8¬™ Ano">8¬™ Ano</option>
            <option value="9¬™ Ano">9¬™ Ano</option>
        </select>
    
        <select id="filtroTurma" class="form-control">
            <option value="">Selecione a Turma</option>
            <option value="A">Turma A</option>
            <option value="B">Turma B</option>
            <option value="C">Turma C</option>
        </select>
    
        <select id="filtroPeriodo" class="form-control">
            <option value="">Selecione o Per√≠odo</option>
            <option value="Manh√£">Manh√£</option>
            <option value="Tarde">Tarde</option>
        </select>
    
        <button onclick="buscarAluno()">Buscar</button>
    
        <table id="tabelaAlunos" style="display: none;"> <!-- Tabela inicialmente oculta -->
            <thead>
                <tr>
                    <th>Foto</th>
                    <th>Nome</th>
                    <th>RA</th>
                    <th>S√©rie</th>
                    <th>Per√≠odo</th>
                </tr>
            </thead>
            <tbody>
                <!-- Os alunos ser√£o inseridos aqui via JavaScript -->
            </tbody>
        </table>
    
        <!-- Bot√£o Limpar Busca, inicialmente invis√≠vel -->
        <button id="limparBusca" style="display: none;" onclick="limparBusca()">Limpar Busca</button>
    </div>

    <script>
        function buscarAluno() {
            const query = document.getElementById('busca').value.trim();  // Nome ou RA/RG
            const serie = document.getElementById('filtroSerie').value;
            const turma = document.getElementById('filtroTurma').value;
            const periodo = document.getElementById('filtroPeriodo').value;
        
            // Enviar requisi√ß√£o AJAX para o backend
            fetch(`/buscar_aluno/?q=${query}&serie=${serie}&turma=${turma}&periodo=${periodo}`)
                .then(response => response.json())
                .then(data => {
                    const tabela = document.getElementById('tabelaAlunos').getElementsByTagName('tbody')[0];
                    tabela.innerHTML = '';  // Limpa a tabela antes de preencher
        
                    if (data.length > 0) {
                        // Torna a tabela vis√≠vel ao clicar no bot√£o "Buscar"
                        document.getElementById('tabelaAlunos').style.display = 'table';
                        // Exibe o bot√£o "Limpar Busca"
                        document.getElementById('limparBusca').style.display = 'inline-block';
        
                        data.forEach(aluno => {
                            let row = tabela.insertRow();
        
                            let cellFoto = row.insertCell(0);
                            let cellNome = row.insertCell(1);
                            let cellRA = row.insertCell(2);
                            let cellSerie = row.insertCell(3);
                            let cellPeriodo = row.insertCell(4);
        
                            // Adiciona um evento de clique na linha para redirecionar para a p√°gina de detalhes
                            row.onclick = function () {
                                window.location.href = `/detalhes_aluno/${aluno.id_aluno}/`;  // Redireciona para a p√°gina de detalhes
                            };
        
                            cellFoto.innerHTML = `<img src="${aluno.foto}" alt="Foto do Aluno" width="50" height="50">`;
                            cellNome.innerHTML = aluno.nome;
                            cellRA.innerHTML = aluno.id_aluno;
                            cellSerie.innerHTML = aluno.serie;
                            cellPeriodo.innerHTML = aluno.periodo;
                        });
                    } else {
                        // Caso nenhum aluno seja encontrado, a tabela ficar√° vis√≠vel e exibir√° uma mensagem
                        document.getElementById('tabelaAlunos').style.display = 'table';
                        tabela.innerHTML = '<tr><td colspan="5" style="text-align:center;">Nenhum aluno encontrado.</td></tr>';
                        // Exibe o bot√£o "Limpar Busca"
                        document.getElementById('limparBusca').style.display = 'inline-block';
                    }
                })
                .catch(error => {
                    console.error('Erro ao buscar aluno:', error);
                });
        }
        
        // Fun√ß√£o para limpar a busca
        function limparBusca() {
            document.getElementById('busca').value = '';  // Limpa o campo de busca
            document.getElementById('tabelaAlunos').style.display = 'none';  // Esconde a tabela
            document.getElementById('limparBusca').style.display = 'none';  // Esconde o bot√£o Limpar Busca
        }
    </script>

</body>
</html>
